<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <video id="video" src="media/Sequence 01.mp4" controls style="display: none;">
        Your browser does not support the video tag.
    </video>
    <canvas id="canvas">
        Your browser does not support the canvas element.
    </canvas>

    <button id="play-pause-button" type="button">Play</button>
    <button id="volume-up-button" type="button">Volume Up</button>


    <script type="module">
        const video = document.getElementById('video');
        const playPauseButton = document.getElementById('play-pause-button');
        const volumeUpButton = document.getElementById('volume-up-button');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        playPauseButton.addEventListener('click', () => {
            if (video.paused) {
                video.play();
                playPauseButton.textContent = 'Pause';
            } else {
                video.pause();
                playPauseButton.textContent = 'Play';
            }
        });

        volumeUpButton.addEventListener('click', () => {
            //if (video.volume < 1.0) {
                video.volume = Math.min(1.0, video.volume + 0.1);
            //}
        });

        video.addEventListener('loadedmetadata', () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
        });

        video.addEventListener('ended', () => {
            alert('Video has ended.');
        });

        video.addEventListener('play', () => {
            const drawFrame = () => {
                if (video.paused || video.ended) {
                    return;
                }
                ctx.drawImage(video, 0, 0);
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                // for(let i = 0; i < data.length; i += 4) {
                //     const r = data[i];
                //     const g = data[i + 1];
                //     const b = data[i + 2];
                //     const gray = 0.299 * r + 0.587 * g + 0.114 * b;
                //     data[i] = gray;
                //     data[i + 1] = gray;
                //     data[i + 2] = gray;
                // }
                for (let y = 0; y < canvas.height; y++){
                    for (let x = 0; x < canvas.width; x++){
                        const index = (y * canvas.width + x) * 4; // the index of the pixel in the data array
                        const r = data[index];
                        const g = data[index + 1];
                        const b = data[index + 2];
                        const gray = 0.299 * r + 0.587 * g + 0.114 * b;
                        data[index] = gray;
                        data[index + 1] = gray;
                        data[index + 2] = gray;
                    }
                }

                ctx.putImageData(imageData, 0, 0);

                requestAnimationFrame(drawFrame);
            };
            drawFrame();
        });
    </script>
</body>
</html>